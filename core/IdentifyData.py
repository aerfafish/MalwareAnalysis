import torch
from torch.utils.data import DataLoader

from malwareAnalysis.utils.Process import process
from malwareAnalysis.api import InputDataSet
from malwareAnalysis.module.CnnModule import DenseNet_BC


def IdentifyData(moduleFrom, dataFrom, resultTo):

    device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    cnn = DenseNet_BC().to(device)
    model = cnn.load_state_dict(torch.load(moduleFrom))
    dataset = InputDataSet.inputDataSet(dataFrom)
    dataLoader = DataLoader(dataset, batch_size=128, shuffle=True)
    label_list = process(cnn, dataLoader, 0.98)
